<html>
<head>
<title>COMP3311 Week 9 Monday Lecture</title>
<link href='lib/slides.css' rel='stylesheet' type='text/css'>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" async></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
<link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet'>
<link href='lib/prism.css' rel='stylesheet'>
<script src='lib/sg.js'></script>
</head>
<body>
 <DIV class='slideCl1' id="s0"  >
<div class='navCl1'><a href="#s1"><span class='nextArrowCl'>>></span></a> </div> <div class='heading'>COMP3311 Week 9 Monday Lecture</div><p><ul class='indexUl'  style='font-size: 0.7em;'><li class="i"> <a href="#s1">Week 09 Monday</heading></a>
<li class="i"> <a href="#s2">Assignment 2</a>
<li class="i"> <a href="#s3">Relational Algebra</a>
<li class="i"> <a href="#s4">Rename</a>
<li class="i"> <a href="#s6">Selection</a>
<li class="i"> <a href="#s9">Projection</a>
<li class="i"> <a href="#s12">Union</a>
<li class="i"> <a href="#s13">Intersection</a>
<li class="i"> <a href="#s16">Difference</a>
<li class="i"> <a href="#s19">Product</a>
<li class="i"> <a href="#s21">Natural Join</a>
<li class="i"> <a href="#s23">Theta Join</a>
<li class="i"> <a href="#s26">Exercise: Mapping SQL to RelAlg</a>
<li class="i"> <a href="#s27">Division</a>
<li class="i"> <a href="#s30">DBMS Architecture</a>
<li class="i"> <a href="#s34">Query Evaluation</a>
<li class="i"> <a href="#s35">Mapping SQL to RA</a>
<li class="i"> <a href="#s36">Exercise: A Better SQL to RA Mapping</a>
<li class="i"> <a href="#s37">Mapping Example</a>
<li class="i"> <a href="#s38">Exercise: Relational Operation Plan</a>
<li class="i"> <a href="#s39">Query Cost Estimation</a>
<li class="i"> <a href="#s41">Implementations of RA Ops</a>
<li class="i"> <a href="#s42">Query Optimisation</a>
<li class="i"> <a href="#s44">DB Application Performance</a>
</ul></DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [0/45]</div> <DIV class='slideCl1    ' id="s1"  >
<div class='navCl1'> <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s2"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Week 09 Monday</heading></div></td><td align='right'></td></tr></table>
<p>
<h4>In today's lecture ...</h4>
<ul>
<li> Relational Algebra, DBMS Architecture
</ul>
<h4>Things to do ...</h4>
<ul>
<li> Assignment 2 due by 21:00 THIS Friday (Nov 11)
<li> Understand Python/Psycopg2 real soon
</ul>
<h4>Things to note ...</h4>
<ul>
<li> Exam on Fri 25 Nov, two sessions: morning, afternoon
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [1/45]</div> <DIV class='slideCl1    ' id="s2"  >
<div class='navCl1'><a href="#s1"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s3"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Assignment 2</div></td><td align='right'></td></tr></table>
<p>
<br>
Things to note:
<ul>
<li> 130 submissions so far ... 420 to go
<li> last minute work ... &nbsp;<large><code>db2</code></large>&nbsp; overloaded ... jas/tutors overloaded
<li> send code in email as attachment, <i>not</i> as a screenshot
<li> make sure <large><code>helpers.*</code></large> load without error
<li> don't &nbsp;<large><code>create view</code></large>s within Python code
<li> write queries to answer questions like "Are there any ...?"
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [2/45]</div> <DIV class='slideCl1    ' id="s3"  >
<div class='navCl1'><a href="#s2"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s4"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Relational Algebra</div></td><td align='right'></td></tr></table>
<p>
Relational algebra consists of:
<ul>
<li> <font color='#0000BB'>operands</font>: relations, or variables representing relations
<li> <font color='#0000BB'>operators</font> that map relations to relations
<li> rules for combining operands/operators into expressions
<li> rules for evaluating such expressions
</ul>
Core relational algebra operations:
<ul>
<li> <font color='#0000BB'>selection</font>: choosing a subset of tuples/rows
<li> <font color='#0000BB'>projection</font>: choosing a subset of attributes/columns
<li> <font color='#0000BB'>product</font>, <font color='#0000BB'>join</font>: combining relations
<li> <font color='#0000BB'>union</font>, <font color='#0000BB'>intersection</font>, <font color='#0000BB'>difference</font>: combining relations
<li> <font color='#0000BB'>rename</font>: change names of relations/attributes
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [3/45]</div> <DIV class='slideCl1    ' id="s4"  >
<div class='navCl1'><a href="#s3"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s5"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Rename</div></td><td align='right'></td></tr></table>
<p>
<font color='#0000BB'>Rename</font> provides "schema mapping".
<p>
If expression <i>E</i> returns a relation
<i>R(A<sub>1</sub>, A<sub>2</sub>, ... A<sub>n</sub>)</i>, then
<p>
<div class='center'>
<i>Rename[S(B<sub>1</sub>, B<sub>2</sub>, ... B<sub>n</sub>)](E)</i>
</div>
<p>
gives a relation called <i>S</i>
<ul>
<li> containing the same set of tuples as <i>E</i>
<li> but with the name of each attribute changed from <i>A<sub>i</sub></i>
to <i>B<sub>i</sub></i>
</ul>
Rename is like the identity function on the <i>contents</i> of a relation
<p>
The only thing that Rename changes is the schema.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [4/45]</div> <DIV class='slideCl1    ' id="s5"  >
<div class='navCl1'><a href="#s4"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s6"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Rename <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
<font color='#0000BB'>Rename</font> can be viewed as a "technical" apparatus of RA.
<p>
Can use implicit rename/project in sequences of RA operations, e.g.
<p><pre style="font-size:90%">
<span class='comment'>--  R(a,b,c),  S(c,d)</span>
Res = Rename[Res(b,c,d)](Project[b,c](Sel[a>5](R)) Join S)
<span class='comment'>-- vs</span>
Tmp1 = Select[a>5](R)
Tmp2 = Project[b,c](Tmp1)
Tmp3 = Rename[Tmp3(cc,d)](S)
Tmp4 = Tmp2 Join[c=cc] Tmp3
Res  = Rename[Res(b,c,d)](Tmp4)
<span class='comment'>-- vs</span>
Tmp1(b,c)  = Select[a>5](R)
Tmp2(cc,d) = S
Res(b,c,d) = Tmp1 Join[c=cc] Tmp2
</pre><p>
In SQL, can achieve a similar effect by defining a set of views
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [5/45]</div> <DIV class='slideCl1    ' id="s6"  >
<div class='navCl1'><a href="#s5"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s7"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Selection</div></td><td align='right'></td></tr></table>
<p>
<font color='#0000BB'>Selection</font> returns a subset of the tuples
in a relation <i>r(R)</i> that satisfy a specified condition <i>C</i>.
<p>
<div class='center'>
<i><span style="font-size:150%">&sigma;</span><sub>C</sub>(r)</i> &nbsp; = &nbsp; <i>Sel[C](r)</i> &nbsp; = &nbsp; { <i>t</i> &nbsp;|&nbsp; <i>t &isin; r &and; C(t)</i> }
</div>
<p>
<i>C</i> is a boolean expression on attributes in <i>R</i>.
<p>
Result size: &nbsp; |<i><span style="font-size:150%">&sigma;</span><sub>C</sub>(r)</i>| <i>&le;</i> |<i>r</i>|
<p>
Result schema: &nbsp; same as the schema of <i>r</i> &nbsp; (i.e. <i>R</i>)
<p>
Algorithmic view:
<p><pre>
<i>result</i> = {}
for each tuple <i>t</i> in relation <i>r</i>
    if (<i>C(t)</i>) { <i>result</i> = <i>result &cup; {t}</i> }
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [6/45]</div> <DIV class='slideCl1    ' id="s7"  >
<div class='navCl1'><a href="#s6"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s8"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Selection <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Examples of selection:
<p>
<p><div align='center'>
<img alt="[Diagram:Pics/relalg/selection2.png]" src="Pics/relalg/selection2.png">
</div><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [7/45]</div> <DIV class='slideCl1    ' id="s8"  >
<div class='navCl1'><a href="#s7"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s9"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Selection <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Querying with relational algebra (selection) ...
<ul>
<br>
<li> Details of all bars in The Rocks
<p><pre>
Result = Sel[addr='The Rocks'](Bars)
</pre><p>
<br>
<li> Beers made by Sierra Nevada
<p><pre>
SNBeers = Sel[manf='Sierra Nevada'](Beers)
Result  = Rename[beer](Proj[name](SNBeers))
</pre><p>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [8/45]</div> <DIV class='slideCl1    ' id="s9"  >
<div class='navCl1'><a href="#s8"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s10"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Projection</div></td><td align='right'></td></tr></table>
<p>
<font color='#0000BB'>Projection</font> returns a set of tuples containing
a subset of the attributes in the original relation.
<p>
<div class='center'>
<i><span style="font-size:150%">&pi;</span><sub>X</sub>(r)</i> &nbsp; = &nbsp; <i>Proj[X](r)</i> &nbsp; = &nbsp; { <i>t[X]</i> &nbsp;|&nbsp; <i>t &isin; r</i> }, &nbsp;&nbsp;&nbsp; where <i>r(R)</i>
</div>
<p>
<i>X</i> specifies a subset of the attributes of <i>R</i>.
<p>
Note that removing key attributes can produce duplicates.
<p>
In RA, duplicates are removed from the result <font color='#0000BB'>set</font>.
<br>
<small><font color="#777777">(In RDBMS's, duplicates are retained &nbsp; (i.e. they use bags, not sets)</small>)</font></small>
<p>
Result size: &nbsp; |<i><span style="font-size:150%">&pi;</span><sub>X</sub>(r)</i>| <i>&le;</i> |<i>r</i>|
&nbsp;&nbsp;&nbsp;
Result schema: &nbsp; <i>R'(X)</i>
<p>
Algorithmic view:
<p><pre>
<i>result</i> = {}
for each tuple <i>t</i> in relation <i>r</i>
    <i>result</i> = <i>result &cup; {t[X]}</i>
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [9/45]</div> <DIV class='slideCl1    ' id="s10"  >
<div class='navCl1'><a href="#s9"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s11"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Projection <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Examples of projection:
<p>
<p><div align='center'>
<img alt="[Diagram:Pics/relalg/projection2.png]" src="Pics/relalg/projection2.png">
</div><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [10/45]</div> <DIV class='slideCl1    ' id="s11"  >
<div class='navCl1'><a href="#s10"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s12"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Projection <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Querying with relational algebra (projection)...
<ul>
<br>
<li> Names of all beers
<p><pre>
Result = Proj[name](Beers)
</pre><p>
<li> Names of drinkers who live in Newtown
<p><pre>
Result = Proj[name](Sel[addr='Newtown'](Drinkers))
</pre><p>
<li> What are all of the breweries?
<p><pre>
Result(brewer) = Proj[manf](Beers)
</pre><p>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [11/45]</div> <DIV class='slideCl1    ' id="s12"  >
<div class='navCl1'><a href="#s11"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s13"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Union</div></td><td align='right'></td></tr></table>
<p>
<font color='#0000BB'>Union</font> combines two <font color='#0000BB'>compatible</font> relations into
a single relation via set union of sets of tuples.
<p>
<div class='center'>
<i>r<sub>1</sub> &cup; r<sub>2</sub></i> &nbsp; = &nbsp; { <i>t</i> &nbsp;|&nbsp; <i>t &isin; r<sub>1</sub> &or; t &isin; r<sub>2</sub></i> }, &nbsp;&nbsp;&nbsp; where <i>r<sub>1</sub>(R), r<sub>2</sub>(R)</i>
</div>
<p>
Compatibility = both relations have the same schema
<p>
Result size: &nbsp; |<i>r<sub>1</sub> &cup; r<sub>2</sub></i>| &nbsp; <i>&le;</i> &nbsp;
|<i>r<sub>1</sub></i>| + |<i>r<sub>2</sub></i>|
&nbsp;&nbsp;&nbsp;
Result schema: <i>R</i>
<p>
Algorithmic view:
<p><pre>
<i>result</i> = <i>r<sub>1</sub></i>
for each tuple <i>t</i> in relation <i>r<sub>2</sub></i>
    <i>result</i> = <i>result &cup; {t}</i>
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [12/45]</div> <DIV class='slideCl1    ' id="s13"  >
<div class='navCl1'><a href="#s12"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s14"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Intersection</div></td><td align='right'></td></tr></table>
<p>
<font color='#0000BB'>Intersection</font> combines two <font color='#0000BB'>compatible</font>
relations into a single relation via set intersection of sets of tuples.
<p>
<div class='center'>
<i>r<sub>1</sub> &cap; r<sub>2</sub></i> &nbsp; = &nbsp; { <i>t</i> &nbsp;|&nbsp; <i>t &isin; r<sub>1</sub> &and; t &isin; r<sub>2</sub></i> }, &nbsp;&nbsp;&nbsp; where <i>r<sub>1</sub>(R), r<sub>2</sub>(R)</i>
</div>
<p>
Uses same notion of relation compatibility as union.
<p>
Result size: &nbsp; |<i>r<sub>1</sub> &cup; r<sub>2</sub></i>| &nbsp; <i>&le;</i> &nbsp;
min(|<i>r<sub>1</sub></i>|,|<i>r<sub>2</sub></i>|)
&nbsp;&nbsp;&nbsp;
Result schema: <i>R</i>
<p>
Algorithmic view:
<p><pre>
<i>result</i> = {}
for each tuple <i>t</i> in relation <i>r<sub>1</sub></i>
    if (<i>t &isin; r<sub>2</sub></i>) { <i>result</i> = <i>result &cup; {t}</i> }
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [13/45]</div> <DIV class='slideCl1    ' id="s14"  >
<div class='navCl1'><a href="#s13"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s15"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Intersection <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Examples of union and intersection:
<p>
<p><div align='center'>
<img alt="[Diagram:Pics/relalg/setops.png]" src="Pics/relalg/setops.png">
</div><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [14/45]</div> <DIV class='slideCl1    ' id="s15"  >
<div class='navCl1'><a href="#s14"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s16"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Intersection <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Querying with relational algebra (set operations)...
<ul>
<br>
<li> Bars where either John or Gernot drinks
<p><pre>
JohnBars = Proj[bar](Sel[drinker=John](Frequents))
GernotBars = Proj[bar](Sel[drinker=Gernot](Frequents))

Result = JohnBars &cup; GernotBars
</pre><p>
<br>
<li> Bars where both John and Gernot drink
<p><pre>
Result = JohnBars  &cap;  GernotBars
</pre><p>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [15/45]</div> <DIV class='slideCl1    ' id="s16"  >
<div class='navCl1'><a href="#s15"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s17"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Difference</div></td><td align='right'></td></tr></table>
<p>
<font color='#0000BB'>Difference</font> finds the set of tuples that exist in
one relation but do not occur in a second <font color='#0000BB'>compatible</font> relation.
<p>
<div class='center'>
<i>r<sub>1</sub> - r<sub>2</sub></i> &nbsp; = &nbsp; { <i>t</i> &nbsp;|&nbsp; <i>t &isin; r<sub>1</sub> &and; t &notin; r<sub>2</sub></i> }, &nbsp;&nbsp;&nbsp; where <i>r<sub>1</sub>(R), r<sub>2</sub>(R)</i>
</div>
<p>
Uses same notion of relation compatibility as union.
<p>
Note:
tuples in <i>r<sub>2</sub></i> but not <i>r<sub>1</sub></i> do not appear in the result
<ul>
<li> i.e. set difference != complement of set intersection
</ul>
Algorithmic view:
<p><pre>
<i>result</i> = {}
for each tuple <i>t</i> in relation <i>r<sub>1</sub></i>
    if (!(<i>t &isin; r<sub>2</sub></i>)) { <i>result</i> = <i>result &cup; {t}</i> }
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [16/45]</div> <DIV class='slideCl1    ' id="s17"  >
<div class='navCl1'><a href="#s16"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s18"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Difference <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Examples of difference:
<p>
<p><div align='center'>
<img alt="[Diagram:Pics/relalg/difference2.png]" src="Pics/relalg/difference2.png">
</div><p>
&nbsp;<p>
Clearly, difference is not symmetric.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [17/45]</div> <DIV class='slideCl1    ' id="s18"  >
<div class='navCl1'><a href="#s17"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s19"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Difference <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Querying with relational algebra (difference) ...
<ul>
<br>
<li> Bars where John drinks and Gernot doesn't
<p><pre>
JohnBars = Proj[bar](Sel[drinker=John](Frequents))
GernotBars = Proj[bar](Sel[drinker=Gernot](Frequents))

Result = JohnBars - GernotBars
</pre><p>
<br>
<li> Bars that sell VB but not New
<p><pre>
VBBars = Proj[bar](Sel[beer=VB](Sells))
NewBars = Proj[bar](Sel[beer=New](Sells))

Result = VBBars - NewBars
</pre><p>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [18/45]</div> <DIV class='slideCl1    ' id="s19"  >
<div class='navCl1'><a href="#s18"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s20"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Product</div></td><td align='right'></td></tr></table>
<p>
<font color='#0000BB'>Product</font> (Cartesian product) combines information from
two relations pairwise on tuples.
<p>
<div class='center'>
<i>r &times; s</i> &nbsp; = &nbsp; { <i>(t<sub>1</sub> : t<sub>2</sub>)</i> &nbsp;|&nbsp; <i>t<sub>1</sub> &isin; r &and; t<sub>2</sub> &isin; s</i> }, &nbsp;&nbsp;&nbsp; where <i>r(R), s(S)</i>
</div>
<p>
Each tuple in the result contains all attributes from <i>r</i> and <i>s</i>,
possibly with some fields renamed to avoid ambiguity.
<p>
If <i>t<sub>1</sub> = (A<sub>1</sub>...A<sub>n</sub>)</i> and
   <i>t<sub>2</sub> = (B<sub>1</sub>...B<sub>n</sub>)</i> then
   <i>(t<sub>1</sub>:t<sub>2</sub>) = (A<sub>1</sub>...A<sub>n</sub>,B<sub>1</sub>...B<sub>n</sub>)</i>
<p>
Note: relations do not have to be union-compatible.
<p>
Result size is <font color='#0000BB'>large</font>: &nbsp; |<i>r &times; s</i>| = |<i>r</i>|.|<i>s</i>|
&nbsp;&nbsp;&nbsp;
Schema: <i>R&cup;S</i>
<p>
Algorithmic view:
<p><pre>
<i>result</i> = {}
for each tuple <i>t<sub>1</sub></i> in relation <i>r</i>
    for each tuple <i>t<sub>2</sub></i> in relation <i>s</i>
        <i>result</i> = <i>result &cup; {(<i>t<sub>1</sub>:t<sub>2</sub></i>)}</i>
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [19/45]</div> <DIV class='slideCl1    ' id="s20"  >
<div class='navCl1'><a href="#s19"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s21"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Product <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Example of product:
<p><br>
<p><div align='center'>
<img alt="[Diagram:Pics/relalg/product.png]" src="Pics/relalg/product.png">
</div><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [20/45]</div> <DIV class='slideCl1    ' id="s21"  >
<div class='navCl1'><a href="#s20"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s22"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Natural Join</div></td><td align='right'></td></tr></table>
<p>
<font color='#0000BB'>Natural join</font> is a specialised product:
<ul>
<li> containing only pairs that match on <font color='#0000BB'>common</font> attributes
<li> with one of each pair of common attributes eliminated
</ul>
Consider relation schemas <i>R(ABC..J<font color="#008800">KLM</font>)</i>,  <i>S(<font color="#008800">KLM</font>N..XYZ)</i>.
<p>
The natural join of relations <i>r(R)</i> and <i>s(S)</i> is defined as:
<p>
<div class='center'>
<i>r &#8904; s</i> &nbsp; = &nbsp; <i>r Join s</i> &nbsp; = &nbsp; <br>
	{ <i>(t<sub>1</sub>[ABC..J] : t<sub>2</sub>[K..XYZ])</i> &nbsp;|&nbsp;
	  <i>t<sub>1</sub> &isin; r &and; t<sub>2</sub> &isin; s &and; match</i>
	}
<p>
where &nbsp;&nbsp; <i>match</i> &nbsp; = &nbsp;
		<i>t<sub>1</sub>[K] = t<sub>2</sub>[K] &and;
		t<sub>1</sub>[L] = t<sub>2</sub>[L] &and;
		t<sub>1</sub>[M] = t<sub>2</sub>[M]</i>
</div>
<p>
Algorithmic view:
<p><pre>
<i>result</i> = {}
for each tuple <i>t<sub>1</sub></i> in relation <i>r</i>
   for each tuple <i>t<sub>2</sub></i> in relation <i>s</i>
      if (<i>matches(t<sub>1</sub>,t<sub>2</sub>)</i>)
         <i>result</i> = <i>result &cup; {combine(<i>t<sub>1</sub>,t<sub>2</sub></i>)}</i>
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [21/45]</div> <DIV class='slideCl1    ' id="s22"  >
<div class='navCl1'><a href="#s21"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s23"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Natural Join <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Example of natural join:
<p><br>
<p><div align='center'>
<img alt="[Diagram:Pics/relalg/nat-join.png]" src="Pics/relalg/nat-join.png">
</div><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [22/45]</div> <DIV class='slideCl1    ' id="s23"  >
<div class='navCl1'><a href="#s22"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s24"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Theta Join</div></td><td align='right'></td></tr></table>
<p>
The <font color='#0000BB'>theta join</font> is a specialised product
containing only pairs that match on a supplied condition <i>C</i>.
<p>
<div class='center'>
<i>r &#8904;<sub>C</sub> s</i> &nbsp; = &nbsp; { <i>(t<sub>1</sub> : t<sub>2</sub>)</i> &nbsp;|&nbsp; <i>t<sub>1</sub> &isin; r &and; t<sub>2</sub> &isin; s &and; C(t<sub>1</sub> : t<sub>2</sub>)</i> }, <br>
where <i>r(R),s(S)</i>
</div>
<p>
Examples: &nbsp; <i>(r1 Join[B>E] r2)</i> ... <i>(r1 Join[E&lt;D&and;C=G] r2)</i>
<p>
All attribute names are required to be distinct <small>(cf natural join)</small>
<p>
Can be defined in terms of other RA operations:
<p>
<div class='center'>
<i>r &#8904;<sub>C</sub> s</i> &nbsp; = &nbsp; <i>r Join[C] s</i> &nbsp; = &nbsp; <i> Sel[C] ( r &times; s )</i>
</div>
<p>
Note that &nbsp; <i>r &#8904;<sub>true</sub> s &nbsp; = &nbsp; r &times; s</i>.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [23/45]</div> <DIV class='slideCl1    ' id="s24"  >
<div class='navCl1'><a href="#s23"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s25"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Theta Join <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Example theta join:
<p>
<p><div align='center'>
<img alt="[Diagram:Pics/relalg/join2.png]" src="Pics/relalg/join2.png">
</div><p>
<p align="right">(Theta join is the most frequently-used join in SQL queries)</p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [24/45]</div> <DIV class='slideCl1    ' id="s25"  >
<div class='navCl1'><a href="#s24"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s26"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Theta Join <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Querying with relational algebra (join) ...
<ul>
<br>
<li> Who drinks in Newtown bars?
<p><pre>
NewtownBars(nbar) = Sel[addr=Newtown](Bars)
Tmp = Frequents Join[bar=nbar] NewtownBars
Result(drinker) = Proj[drinker](Tmp)
</pre><p>
<li> Who drinks beers made by Carlton?
<p><pre>
CarltonBeers = Sel[manf=Carlton](Beers)
Tmp = Likes Join[beer=name] CarltonBeers
Result(drinker) = Proj[drinker)Tmp
</pre><p>
</ul>
<p><br>
Reminder: projection removes duplicates
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [25/45]</div> <DIV class='slideCl1    ' id="s26"  >
<div class='navCl1'><a href="#s25"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s27"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise: Mapping SQL to RelAlg</div></td><td align='right'></td></tr></table>
<p>
<br>
Give sequences of relational algebra operations to solve each of these:
<ul>
<li> Find bars that serve New at the same price<br>
as the Coogee Bay Hotel charges for VB. <br><br>
<li> Which bar is most popular? (Most drinkers) <br><br>
<li> Price of cheapest beer at each bar? <br><br>
<li> Which beers are sold at all bars?
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [26/45]</div> <DIV class='slideCl1    ' id="s27"  >
<div class='navCl1'><a href="#s26"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s28"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Division</div></td><td align='right'></td></tr></table>
<p>
Consider two relation schemas <i>R</i> and <i>S</i> where <i>S &sub; R</i>.
<p>
The <font color='#0000BB'>division</font> operation is defined on instances <i>r(R)</i>, <i>s(S)</i> as:
<p>
<div class='center'>
<i>r / s</i> &nbsp; = &nbsp; <i>r Div s</i> &nbsp; = &nbsp;
	{ <i>t</i> | <i>t &isin; r[R-S] &and; satisfy</i> }
<p>
where &nbsp; <i>satisfy</i> &nbsp; = &nbsp; <i>&forall; t<sub>s</sub> &isin; S ( &exist; t<sub>r</sub> &isin; R ( t<sub>r</sub>[S] = t<sub>s</sub> &and; t<sub>r</sub>[R-S] = t ) )</i>
</div>
<p>
Operationally:
<ul>
<li> consider each subset of tuples in <i>R</i> that match on <i>t[R-S]</i>
<li> for this subset of tuples, take the <i>t[S]</i> values from each
<li> if this covers all tuples in <i>S</i>, then include <i>t[R-S]</i> in the result
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [27/45]</div> <DIV class='slideCl1    ' id="s28"  >
<div class='navCl1'><a href="#s27"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s29"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Division <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Example of division:
<p><br>
<p><div align='center'>
<img alt="[Diagram:Pics/relalg/division2.png]" src="Pics/relalg/division2.png">
</div><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [28/45]</div> <DIV class='slideCl1    ' id="s29"  >
<div class='navCl1'><a href="#s28"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s30"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Division <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Querying with relational algebra (division) ...
<p>
Division handles queries that include the notion "for all".
<p>
E.g. Which beers are sold in all bars?</font>
<p>
We can answer this as follows:
<ul>
<li> generate a relation of beers and bars where they are sold
<ul>
<li>	<i>r1 = Proj[beer,bar](Sold)</i>
</ul>
<li> generate a relation of all bars
<ul>
<li> <i>r2 = Rename[r2(bar)](Proj[name](Bars))</i>
</ul>
<li> find which beers appear in tuples with <font color='#0000BB'>every</font> bar
<ul>
<li> <i>res &nbsp; = r1 Div r2</i>
</ul>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [29/45]</div> <DIV class='slideCl1    ' id="s30"  >
<div class='navCl1'><a href="#s29"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s31"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; DBMS Architecture</div></td><td align='right'></td></tr></table>
<p>
COMP3311 is not a course on DBMS Architecture <tiny>(that's COMP9315)</tiny>
<p>
But knowing just a little about how DBMSs work can help
<ul>
<li> to avoid/fix inefficiencies in database applications
<li> ensure that there are no concurrency issues
</ul>
DBMSs attempt to handle these issues in ..
<ul>
<li> query processing (QP) .. methods for evaluating queries
<li> transaction processing (TxP) ... controlling concurrency
</ul>
As a programmer, you give a lot of control to the DBMS, but can
<ul>
<li> use QP knowledge to make DB applications <font color='#0000BB'>efficient</font>
<li> use TxP knowledge to make DB applications <font color='#0000BB'>safe</font>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [30/45]</div> <DIV class='slideCl1    ' id="s31"  >
<div class='navCl1'><a href="#s30"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s32"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; DBMS Architecture <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Our view of the DBMS so far ...
<p><br>
<p><div align='center'>
<img alt="[Diagram:Pics/dbms/qryeval0.png]" src="Pics/dbms/qryeval0.png">
</div><p>
<p><br>
A machine to process SQL queries.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [31/45]</div> <DIV class='slideCl1    ' id="s32"  >
<div class='navCl1'><a href="#s31"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s33"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; DBMS Architecture <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
One view of DB engine: "<font color='#0000BB'>relational algebra</font> virtual machine"
<p>
<div class='center'>
<table border='0' cellpadding='4'>
<tr valign=top>
<td><nobr> selection (<i><span style="font-size:150%">&sigma;</span></i>) </td>
<td></td><td> projection (<i><span style="font-size:150%">&pi;</span></i>) </td>
<td></td><td> join (<i>&#8904;, &times;</i>) </td>
</tr>
<tr valign=top>
<td><nobr> union (<i>&cup;</i>) </td>
<td></td><td> intersection (<i>&cap;</i>) </td>
<td></td><td> difference (<i>-</i>) </td>
</tr>
<tr valign=top>
<td><nobr> sort </td>
<td></td><td> insert </td>
<td></td><td> delete </td>
</tr>
</table>
</div>
<p>
For each of these operations:
<ul>
<li> various data structures and algorithms are available
<li> DBMSs may provide only one, or may provide a choice
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [32/45]</div> <DIV class='slideCl1    ' id="s33"  >
<div class='navCl1'><a href="#s32"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s34"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; DBMS Architecture <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Layers in a DB Engine <tiny>(Ramakrishnan's View)</tiny>
<p><br>
<p><div align='center'>
<img alt="[Diagram:Pics/dbms/dbms-layers.png]" src="Pics/dbms/dbms-layers.png">
</div><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [33/45]</div> <DIV class='slideCl1    ' id="s34"  >
<div class='navCl1'><a href="#s33"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s35"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Query Evaluation</div></td><td align='right'></td></tr></table>
<p>
The path of a query through its evaluation:
<p><br>
<p><div align='center'>
<img alt="[Diagram:Pics/dbms/qryeval.png]" src="Pics/dbms/qryeval.png">
</div><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [34/45]</div> <DIV class='slideCl1    ' id="s35"  >
<div class='navCl1'><a href="#s34"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s36"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Mapping SQL to RA</div></td><td align='right'></td></tr></table>
<p>
Mapping SQL to relational algebra, e.g.
<p><pre>
<span class='comment'>-- schema: R(a,b) S(c,d)</span>
select a as x
from   R join S on (b=c)
where  d = 100
<span class='comment'>-- could be mapped to</span>
Tmp1(a,b,c,d) = R Join[b=c] S
Tmp2(a,b,c,d) = Sel[d=100](Tmp1)
Tmp3(a)       = Proj[a](Tmp2)
Res(x)        = Rename[Res(x)](Tmp3)
</pre><p>
In general:
<ul>
<li> <large><code>SELECT</code></large> clause becomes <i>projection</i>
<li> <large><code>WHERE</code></large> condition becomes <i>selection</i> or <i>join</i>
<li> <large><code>FROM</code></large> clause becomes <i>join</i>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [35/45]</div> <DIV class='slideCl1    ' id="s36"  >
<div class='navCl1'><a href="#s35"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s37"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise: A Better SQL to RA Mapping</div></td><td align='right'></td></tr></table>
<p>
On the previous slide, we translated an SQL query as follows:
<p><pre>
<span class='comment'>-- schema: R(a,b) S(c,d)</span>
select a as x
from   R join S on (b=c)
where  d = 100
<span class='comment'>-- could be mapped to</span>
Tmp1(a,b,c,d) = R Join[b=c] S
Tmp2(a,b,c,d) = Sel[d=100](Tmp1)
Tmp3(a)       = Proj[a](Tmp2)
Res(x)        = Rename[Res(x)](Tmp3)
</pre><p>
Suggest a better approach.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [36/45]</div> <DIV class='slideCl1    ' id="s37"  >
<div class='navCl1'><a href="#s36"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s38"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Mapping Example</div></td><td align='right'></td></tr></table>
<p>
The query: <i>Courses with more than 100 students in them?</i>
<p>
Can be expressed in SQL as
<p><pre>
select   s.id, s.code
from     Course c, Subject s, Enrolment e
where    c.id = e.course and c.subject = s.id
group by s.id, s.code
having   count(*) > 100;
</pre><p>
and might be compiled to
<p>
<p><pre>
<i>Result =
Project<small>[id,code]</small>(
   GroupSelect<small>[size&gt;100]</small> (
      GroupBy<small>[id,code]</small> (
         Subject Join<small>[s.id=c.subject]</small>
         (Course Join<small>[c.id=e.course]</small> Enrolment)
)  )  )</i>
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [37/45]</div> <DIV class='slideCl1    ' id="s38"  >
<div class='navCl1'><a href="#s37"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s39"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise: Relational Operation Plan</div></td><td align='right'></td></tr></table>
<p>
So far, we have been expressing RA evaluation as follows:
<p><pre>
Tmp(a,b,c,...) =  Op[x](R)  <span class='comment'>or</span>  R Op[x] S
</pre><p>
Each statement involves a single relational algebra operation.
<p>
Render the RA from the previous slide in this form.
<p><br>
Reminder:
<p>
<p><pre>
<i>Result =
Project<small>[id,code]</small>(
   GroupSelect<small>[size&gt;100]</small> (
      GroupBy<small>[id,code]</small> (
         Subject Join<small>[s.id=c.subject]</small>
         (Course Join<small>[c.id=e.course]</small> Enrolment)
)  )  )</i>
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [38/45]</div> <DIV class='slideCl1    ' id="s39"  >
<div class='navCl1'><a href="#s38"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s40"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Query Cost Estimation</div></td><td align='right'></td></tr></table>
<p>
The cost of evaluating a query is determined by
<ul>
<li> the operations specified in the query execution plan
<li> size of relations &nbsp; <small>(database relations and temporary relations)</small>
<li> access mechanisms &nbsp; <small>(indexing, hashing, sorting, join algorithms)</small>
<li> size/number of main memory buffers &nbsp; <small>(and replacement strategy)</small>
</ul>
Analysis of costs involves <i>estimating</i>:
<ul>
<li> the size of intermediate results
<li> then, based on this, cost of secondary storage accesses
</ul>
<br>
Accessing data from disk is the dominant cost in query evaluation
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [39/45]</div> <DIV class='slideCl1    ' id="s40"  >
<div class='navCl1'><a href="#s39"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s41"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Query Cost Estimation <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
An <font color='#0000BB'>execution plan</font> is a sequence of relational operations.
<p>
Consider execution plans for:
	&nbsp;&nbsp; <i> <span style="font-size:150%">&sigma;</span><sub>c</sub> (R &nbsp;&#8904;<sub>d</sub>&nbsp; S &nbsp;&#8904;<sub>e</sub>&nbsp; T) </i>
<p><pre>
tmp1   :=  hash_join[d](R,S)
tmp2   :=  sort_merge_join[e](tmp1,T)
result :=  binary_search[c](tmp2)
</pre><p>
or
<p><pre>
tmp1   :=  sort_merge_join[e](S,T)
tmp2   :=  hash_join[d](R,tmp1)
result :=  linear_search[c](tmp2)
</pre><p>
or
<p><pre>
tmp1   :=  btree_search[c](R)
tmp2   :=  hash_join[d](tmp1,S)
result :=  sort_merge_join[e](tmp2)
</pre><p>
All produce same result, but have different costs.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [40/45]</div> <DIV class='slideCl1    ' id="s41"  >
<div class='navCl1'><a href="#s40"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s42"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Implementations of RA Ops</div></td><td align='right'></td></tr></table>
<p>
Sorting &nbsp; <font color="#777777"><small>(quicksort, etc. are not applicable)</small></font>
<ul>
<li> external merge sort &nbsp; <small>(cost <i>O(Nlog<sub>B</sub>N)</i> with <i>B</i> memory buffers)</small>
</ul>
Selection &nbsp; <font color="#777777"><small>(different techniques developed for different query types)</small></font>
<ul>
<li> sequential scan &nbsp; <small>(worst case, cost <i>O(N)</i>)</small>
<li> index-based &nbsp; <small>(e.g. B-trees, cost <i>O(logN)</i>, tree nodes are pages)</small>
<li> hash-based &nbsp; <small>(<i>O(1)</i> best case, only works for equality tests)</small>
</ul>
Join &nbsp; <font color="#777777"><small>(fast joins are critical to success of relational DBMSs)</small></font>
<ul>
<li> nested-loop join &nbsp; <small>(cost <i>O(N.M)</i>, buffering can reduce to <i>O(N+M)</i>)</small>
<li> sort-merge join &nbsp; <small>(cost <i>O(NlogN+MlogM)</i>)</small>
<li> hash-join &nbsp; <small>(best case cost <i>O(N+M.N/B)</i>, with <i>B</i> memory buffers)</small>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [41/45]</div> <DIV class='slideCl1    ' id="s42"  >
<div class='navCl1'><a href="#s41"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s43"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Query Optimisation</div></td><td align='right'></td></tr></table>
<p>
What is the "best" method for evaluating a query?
<p>
Generally, <i>best</i> = lowest cost = fastest evaluation time
<p>
<font color='#0000BB'>Cost</font> is measured in terms of pages read/written
<ul>
<li> data is stored in fixed-size blocks (e.g. 4KB)
<li> data transferred disk<i>&harr;</i>memory in whole blocks
<li> cost of disk<i>&harr;</i>memory transfer is highest cost in system
<li> processing in memory is very fast compared to I/O
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [42/45]</div> <DIV class='slideCl1    ' id="s43"  >
<div class='navCl1'><a href="#s42"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s44"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Query Optimisation <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
A DBMS <font color='#0000BB'>query optimiser</font> works as follows:
<p>
<p><pre>
Input: relational algebra expression
Output: execution plan (sequence of RA ops)

bestCost = INF; bestPlan = none
while (more possible plans) {
   plan = produce a new evaluation plan
   cost = estimated_cost(plan)
   if (cost < bestCost) {
      bestCost = cost; bestPlan = plan
   }
}
return bestPlan
</pre><p>
Typically, there are very many possible plans
<ul>
<li> smarter optimisers generate likely subset of possible plans
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [43/45]</div> <DIV class='slideCl1    ' id="s44"  >
<div class='navCl1'><a href="#s43"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s45"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; DB Application Performance</div></td><td align='right'></td></tr></table>
<p>
In order to make DB applications efficient, it is useful to know:
<ul>
<li> what operations on the data does the application require
<p>
<small>
(which queries, updates, inserts and how frequently is each one performed)
</small>
<li> how these operations might be implemented in the DBMS
<p>
<small>
(data structures and algorithms for select, project, join, sort, ...)
</small>
<li> how much each implementation will cost
<p>
<small>
(in terms of the amount of data transferred between memory and disk)
</small>
</ul>
and then, "encourage" DBMS to use the most efficient methods
<p>
Achieve by using indexes and avoiding certain SQL query structures
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [44/45]</div> <DIV class='slideCl1    ' id="s45"  >
<div class='navCl1'><a href="#s44"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>   </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; DB Application Performance <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Application programmer choices that affect query cost:
<ul>
<li> how queries are expressed
<ul>
<li> generally join is faster than subquery
<li> especially if subquery is correlated
<li> filter first, then join <tiny>(avoids large intermediate tables)</tiny>
<li> avoid applying functions in where/group-by clasues
</ul>
<li> creating <font color='#0000BB'>indexes</font> on tables
<ul>
<li> index will speed-up filtering based on indexed attributes
<li> indexes generally only effective for equality, gt/lt
<li> mainly useful if filtering much more frequent than update
</ul>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 9 Monday Lecture &#9826; [45/45]</div><p><hr><p>
<span style='font-size:11px;color: grey;'>Produced: 7 Nov 2022</span>
 <script src='lib/prism.js'></script>   
 <script src='lib/sg.js'></script>   
</body>
</html>
