<html>
<head>
<title>COMP3311 Week 8 Monday Lecture</title>
<link href='lib/slides.css' rel='stylesheet' type='text/css'>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" async></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
<link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet'>
<link href='lib/prism.css' rel='stylesheet'>
<script src='lib/sg.js'></script>
</head>
<body>
 <DIV class='slideCl1' id="s0"  >
<div class='navCl1'><a href="#s1"><span class='nextArrowCl'>>></span></a> </div> <div class='heading'>COMP3311 Week 8 Monday Lecture</div><p><ul class='indexUl'  style='font-size: 0.7em;'><li class="i"> <a href="#s1">Week 08 Monday</heading></a>
<li class="i"> <a href="#s2">Database Design (revisited)</a>
<li class="i"> <a href="#s3">Exercise: Functional Dependencies (2)</a>
<li class="i"> <a href="#s4">Exercise: Functional Dependencies (3)</a>
<li class="i"> <a href="#s5">Functional Dependency</a>
<li class="i"> <a href="#s7">Inference Rules</a>
<li class="i"> <a href="#s9">Closures</a>
<li class="i"> <a href="#s13">Exercise: Determining Keys</a>
<li class="i"> <a href="#s14">Normalization</a>
<li class="i"> <a href="#s15">Normal Forms</a>
<li class="i"> <a href="#s18">Relation Decomposition</a>
<li class="i"> <a href="#s19">Schema (Re)Design</a>
<li class="i"> <a href="#s25">Boyce-Codd Normal Form</a>
<li class="i"> <a href="#s27">BCNF Decomposition</a>
<li class="i"> <a href="#s31">Exercise:  BCNF Decomposition (1)</a>
<li class="i"> <a href="#s32">Exercise:  BCNF Decomposition (2)</a>
<li class="i"> <a href="#s33">Third Normal Form</a>
<li class="i"> <a href="#s37">Exercise:  3NF Decomposition (1)</a>
<li class="i"> <a href="#s38">Exercise:  3NF Decomposition (2)</a>
<li class="i"> <a href="#s39">Database Design Methodology</a>
</ul></DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [0/39]</div> <DIV class='slideCl1    ' id="s1"  >
<div class='navCl1'> <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s2"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Week 08 Monday</heading></div></td><td align='right'></td></tr></table>
<p>
<h4>In today's lecture ...</h4>
<ul>
<li> Relational Design Theory: FDs, Normal Forms, Normalisation
</ul>
<h4>Things to do ...</h4>
<ul>
<li> Quiz 5 due by 23:59 Friday 4 November
<li> Assignment 2 due by 21:00 Friday 11 November &nbsp;<small>(Week 9)</small>
<li> Understand Python/Psycopg2 by end of week
</ul>
<h4>Things to note ...</h4>
<ul>
<li> I am away on Thursday and Friday (no web access)
<li> Testing script and submission pages up tonight
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [1/39]</div> <DIV class='slideCl1    ' id="s2"  >
<div class='navCl1'><a href="#s1"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s3"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Database Design (revisited)</div></td><td align='right'></td></tr></table>
<p>
To avoid update problems:
<ul>
<li> need a schema with "minimal overlap" between tables
<li> each table contains a "coherent" collection of data values
</ul>
Such schemas have little/no redundancy
<p>
<br>
ER &rarr; SQL mapping tends to give non-redundant schemas
<ul>
<li> but does not guarantee no redundancy
</ul>
The methods we describe in this section
<ul>
<li> can reduce redundancy in schemas &rArr; eliminate update anomalies
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [2/39]</div> <DIV class='slideCl1    ' id="s3"  >
<div class='navCl1'><a href="#s2"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s4"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise: Functional Dependencies (2)</div></td><td align='right'></td></tr></table>
<p>
Consider this data (possibly from a spreadsheet):
<p><pre style="font-size:80%">
   id   |     name        |   subj   | term |      title      | mark | grade 
--------+-----------------+----------+------+-----------------+------+-------
5123485 | Lillian Seng... | COMP9020 | 17s1 | Foundations ... |      | AF
5123485 | Lillian Seng... | COMP9021 | 17s2 | Principles o... |   46 | FL
5123485 | Lillian Seng... | COMP9020 | 18s1 | Foundations ... |   44 | FL
5123485 | Lillian Seng... | COMP9021 | 18s2 | Principles o... |   46 | FL
5123504 | Yap Huawen      | MATH5960 | 17s1 | Bayesian Inf... |   56 | PS
5123504 | Yap Huawen      | COMP9318 | 17s1 | Data Warehou... |   76 | DN
5123504 | Yap Huawen      | COMP9444 | 17s2 | Neural Netwo... |   53 | PS
5123504 | Yap Huawen      | COMP9814 | 18s1 | Ext Artifici... |      | NF
5123504 | Yap Huawen      | COMP6714 | 18s2 | Info Retriev... |   86 | HD
5123523 | Cindy Nava G... | COMP9313 | 17s1 | Big Data Man... |   55 | PS
5123523 | Cindy Nava G... | COMP9444 | 17s2 | Neural Netwo... |   63 | PS
5123523 | Cindy Nava G... | COMP9417 | 18s1 | Machine Lear... |      | AW
5123523 | Cindy Nava G... | COMP9318 | 19T1 | Data Warehou... |   43 | FL
5123523 | Cindy Nava G... | COMP6714 | 19T3 | Info Retriev... |      | AW
5123523 | Cindy Nava G... | COMP9321 | 20T1 | Data Service... |      | SY
</pre><p>
Identify functional dependencies
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [3/39]</div> <DIV class='slideCl1    ' id="s4"  >
<div class='navCl1'><a href="#s3"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s5"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise: Functional Dependencies (3)</div></td><td align='right'></td></tr></table>
<p>
What functional dependencies exist in the following table:
<p><pre style="font-size:90%">
  A  |  B  |  C  |  D
-----+-----+-----+-----
  1  |  a  |  6  |  x
  2  |  b  |  7  |  y
  3  |  c  |  7  |  z
  4  |  d  |  6  |  x
  5  |  a  |  6  |  y
  6  |  b  |  7  |  z
  7  |  c  |  7  |  x
  8  |  d  |  6  |  y
</pre><p>
How is this case different to the previous ones?
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [4/39]</div> <DIV class='slideCl1    ' id="s5"  >
<div class='navCl1'><a href="#s4"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s6"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Functional Dependency</div></td><td align='right'></td></tr></table>
<p>
Above, we considered dependency within a relation instance <i>r(R)</i>.
<p>
More important for design is dependency across all possible
instances of the relation (i.e. a schema-based dependency).
<p>
This is a simple generalisation of the previous definition:
<ul>
<li> for any <i>t, u &isin; </i><font color="#CC0000">any</font><i> r(R)</i>, &nbsp; <i>t[X] = u[X] &nbsp; &rArr; &nbsp; t[Y] = u[Y]</i>
</ul>
Such dependencies capture semantics of problem domain.
<p>
E.g. course enrolment example
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [5/39]</div> <DIV class='slideCl1    ' id="s6"  >
<div class='navCl1'><a href="#s5"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s7"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Functional Dependency <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Can we generalise some ideas about functional dependency? <br>
<p>
<br>
E.g. are there dependencies that hold for <i>any</i>&nbsp; relation?
<ul>
<li> yes, but they're generally trivial, e.g. <i>Y &sub; X &nbsp; &rArr; &nbsp; X &rarr; Y</i>
</ul>
<br>
E.g. do some dependencies suggest the existence of others?
<ul>
<li> yes, <font color='#0000BB'>rules of inference</font> allow us to <font color='#0000BB'>derive</font> dependencies
<li> allow us to reason about sets of functional dependencies
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [6/39]</div> <DIV class='slideCl1    ' id="s7"  >
<div class='navCl1'><a href="#s6"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s8"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Inference Rules</div></td><td align='right'></td></tr></table>
<p>
<font color='#0000BB'>Armstrong's rules</font> are general rules of inference on <i>fd</i>s.
<p>
F1. <font color='#0000BB'>Reflexivity</font> &nbsp; e.g. &nbsp; <i>X &rarr; X</i>
<p>
F2. <font color='#0000BB'>Augmentation</font> &nbsp; e.g. &nbsp; <i>X &rarr; Y &nbsp;&rArr;&nbsp; XZ &rarr; YZ</i>
<p>
F3. <font color='#0000BB'>Transitivity</font> &nbsp; e.g. &nbsp; <i>X &rarr; Y, Y &rarr; Z &nbsp;&rArr;&nbsp; X &rarr; Z</i>
<p>
F4. <font color='#0000BB'>Additivity</font> &nbsp; e.g. &nbsp; <i>X &rarr; Y, X &rarr; Z &nbsp; &rArr; &nbsp; X &rarr; YZ</i>
<p>
F5. <font color='#0000BB'>Projectivity</font> &nbsp; e.g. &nbsp; <i>X &rarr; YZ &nbsp; &rArr; &nbsp; X &rarr; Y, X &rarr; Z</i>
<p>
F6. <font color='#0000BB'>Pseudotransitivity</font> &nbsp; e.g. &nbsp; <i>X &rarr; Y, YZ &rarr; W &nbsp; &rArr; &nbsp; XZ &rarr; W</i>
<p>
F1 - F3 are essential; the rest are useful to have
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [7/39]</div> <DIV class='slideCl1    ' id="s8"  >
<div class='navCl1'><a href="#s7"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s9"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Inference Rules <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Example: determining validity of <i>AB &rarr; GH</i>, given:
<p>
<div class='center'>
<i>R = ABCDEFGHIJ</i> <p>
<i>F = { AB &rarr; E, &nbsp; AG &rarr; J, &nbsp; BE &rarr; I, &nbsp; E &rarr; G, &nbsp; GI &rarr; H }</i>
</div>
Derivation:
<div class='center'>
<table border='0' cellpadding='4'>
<tr valign=top><td><nobr> 1. &nbsp; </td><td></td><td> <i>AB &rarr; E</i> </td><td></td><td> (given) </td></tr>
<tr valign=top><td><nobr> 2. &nbsp; </td><td></td><td> <i>E &rarr; G</i> </td><td></td><td> (given) </td></tr>
<tr valign=top><td><nobr> 3. &nbsp; </td><td></td><td> <font color="#0000EE"><i>AB &rarr; G</i></font> </td><td></td><td> (using F3 on 1,2) </td></tr>
<tr valign=top><td><nobr> 4. &nbsp; </td><td></td><td> <i>AB &rarr; AB</i> </td><td></td><td> (using F1) </td></tr>
<tr valign=top><td><nobr> 5. &nbsp; </td><td></td><td> <i>AB &rarr; B</i> </td><td></td><td> (using F5 on 4) </td></tr>
<tr valign=top><td><nobr> 6. &nbsp; </td><td></td><td> <i>AB &rarr; BE</i> </td><td></td><td> (using F4 on 1,5) </td></tr>
<tr valign=top><td><nobr> 7. &nbsp; </td><td></td><td> <i>BE &rarr; I</i> </td><td></td><td> (given) </td></tr>
<tr valign=top><td><nobr> 8. &nbsp; </td><td></td><td> <i>AB &rarr; I</i> </td><td></td><td> (using F3 on 6,7) </td></tr>
<tr valign=top><td><nobr> 9. &nbsp; </td><td></td><td> <i>AB &rarr; GI</i> </td><td></td><td> (using F4 on 3,8) </td></tr>
<tr valign=top><td><nobr> 10. </td><td></td><td> <i>GI &rarr; H</i> </td><td></td><td> (given) </td></tr>
<tr valign=top><td><nobr> 11. </td><td></td><td> <font color="#0000EE"><i>AB &rarr; H</i></font> </td><td></td><td> (using F3 on 9,10) </td></tr>
<tr valign=top><td><nobr> 12. </td><td></td><td> <i>AB &rarr; GH</i> </td><td></td><td> (using F4 on 3,11) </td></tr>
</table>
</div>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [8/39]</div> <DIV class='slideCl1    ' id="s9"  >
<div class='navCl1'><a href="#s8"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s10"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Closures</div></td><td align='right'></td></tr></table>
<p>
<br>
Given a set <i>F</i> of <i>fd</i>s, how many new <i>fd</i>s can we derive?
<p>
For a finite set of attributes, there must be a finite set of derivable <i>fd</i>s.
<p>
<font color='#0000BB'>Closure</font> = <i>F<sup>+</sup></i>&nbsp; = largest collection of dependencies derivable from <i>F</i>
<p>
Closures allow us to answer two interesting questions:
<ul>
<li> is a particular dependency <i>X &rarr; Y</i> derivable from <i>F</i>?
<li> are two sets of dependencies <i>F</i> and <i>G</i> equivalent?
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [9/39]</div> <DIV class='slideCl1    ' id="s10"  >
<div class='navCl1'><a href="#s9"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s11"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Closures <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
For the question "is <i>X &rarr; Y</i> derivable from <i>F</i>?" ...
<ul>
<li> compute the closure <i>F<sup>+</sup></i>;
	check whether <i>X &rarr; Y &nbsp; &isin; &nbsp; F<sup>+</sup></i>
</ul>
<br>
For the question "are <i>F</i> and <i>G</i> equivalent?" ...
<ul>
<li> compute closures <i>F<sup>+</sup></i> and <i>G<sup>+</sup></i>;
	check whether they're equal
</ul>
<br>
Unfortunately, closures can be very large, e.g.
<p>
<small>
<i>R = ABC, &nbsp;&nbsp;&nbsp; F = { AB &rarr; C, &nbsp; C &rarr; B }</i> <br>
<i>F<sup>+</sup> = { A &rarr; A, &nbsp; AB &rarr; A, &nbsp;
	AC &rarr; A, &nbsp; AB &rarr; B, &nbsp;
	BC &rarr; B, &nbsp; ABC &rarr; B, &nbsp;
<br> &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
	C &rarr; C, &nbsp; AC &rarr; C, &nbsp;
	BC &rarr; C, &nbsp; ABC &rarr; C, &nbsp;
	AB &rarr; AB, &nbsp; . . . . . . ,
<br> &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        AB &rarr; ABC, &nbsp; AB &rarr; ABC, &nbsp;
	C &rarr; B, &nbsp; C &rarr; BC, &nbsp;
	AC &rarr; B, &nbsp; AC &rarr; AB }</i>
</small>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [10/39]</div> <DIV class='slideCl1    ' id="s11"  >
<div class='navCl1'><a href="#s10"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s12"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Closures <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Algorithms based on <i>F<sup>+</sup></i> rapidly become infeasible.
<p>
To solve this problem ...
<ul>
<li>  use closures based on sets of attributes rather than sets of <i>fd</i>s.
</ul>
<p>
Given a set <i>X</i> of attributes and a set <i>F</i> of <i>fd</i>s,
the <font color='#0000BB'>closure</font> of <i>X</i> (denoted <i>X<sup>+</sup></i>) is
<ul>
<li> the largest set of attributes that can be derived from <i>X</i> using
<i>F</i>
</ul>
<p>
We can prove <small>(using additivity)</small> that &nbsp;&nbsp; <i>(X &rarr; Y) &isin; F<sup>+</sup></i> &nbsp; iff &nbsp; <i>Y &sub; X<sup>+</sup></i>.
<p>
For computation purposes, |<i>X<sup>+</sup></i>| is bounded by the number of attributes.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [11/39]</div> <DIV class='slideCl1    ' id="s12"  >
<div class='navCl1'><a href="#s11"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s13"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Closures <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
For the question "is <i>X &rarr; Y</i> derivable from <i>F</i>?" ...
<ul>
<li> compute the closure <i>X<sup>+</sup></i>,
	check whether <i>Y &nbsp; &sub; &nbsp; X<sup>+</sup></i>
</ul>
<br>
For the question "are <i>F</i> and <i>G</i> equivalent?" ...
<ul>
<li> for each dependency in <i>G</i>, check whether derivable from <i>F</i>
<li> for each dependency in <i>F</i>, check whether derivable from <i>G</i>
<li> if true for all, then 
	<i>F &rArr; G</i> and <i>G &rArr; F</i>
	which implies <i>F<sup>+</sup> = G<sup>+</sup></i>
</ul>
<br>
For the question "what are the keys of <i>R</i> implied by <i>F</i>?" ...
<ul>
<li> find subsets <i>K &sub; R</i> such that <i>K<sup>+</sup> = R</i>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [12/39]</div> <DIV class='slideCl1    ' id="s13"  >
<div class='navCl1'><a href="#s12"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s14"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise: Determining Keys</div></td><td align='right'></td></tr></table>
<p>
Determine possible primary keys for each of the following:
<ol>
<li> <i> FD &nbsp;=&nbsp; { A &rarr; B, C &rarr; D, E &rarr; FG }</i>
<li> <i> FD &nbsp;=&nbsp; { A &rarr; B, B &rarr; C, C &rarr; D }</i>
<li> <i> FD &nbsp;=&nbsp; { A &rarr; B, B &rarr; C, C &rarr; A }</i>
<li> <i> FD &nbsp;=&nbsp; { AB &rarr; C, &nbsp; C &rarr; B }</i>
<li> <i> FD &nbsp;=&nbsp; { MN &rarr; P, NP &rarr; Q, Q &rarr; R }</i>
<li> <i> FD &nbsp;=&nbsp; { ABH &rarr; C, A &rarr; DE, BGH &rarr; F,
F &rarr; ADH, BH &rarr; GE }</i>
<li> <i> FD &nbsp;=&nbsp; { ABH &rarr; C, A &rarr; D, C &rarr; E F &rarr; A, E &rarr; F, BGH &rarr; E }</i>
</ol>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [13/39]</div> <DIV class='slideCl1    ' id="s14"  >
<div class='navCl1'><a href="#s13"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s15"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Normalization</div></td><td align='right'></td></tr></table>
<p>
<font color='#0000BB'>Normalization</font>: branch of relational theory providing design insights.
<p>
The goals of normalization:
<ul>
<li> be able to characterise the level of redundancy in a relational schema
<li> provide mechanisms for transforming schemas to remove redundancy
</ul>
<p>
Normalization draws heavily on the theory of functional dependencies.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [14/39]</div> <DIV class='slideCl1    ' id="s15"  >
<div class='navCl1'><a href="#s14"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s16"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Normal Forms</div></td><td align='right'></td></tr></table>
<p>
Normalization theory defines six <font color='#0000BB'>normal forms</font> (NFs).
<ul>
<li> First,Second,Third Normal Forms (1NF,2NF,3NF) <small>(Codd 1972)</small>
<li> Boyce-Codd Normal Form (BCNF) <small>(1974)</small>
<li> Fourth Normal Form (4NF) <small>(Zaniolo 1976, Fagin 1977)</small>
<li> Fifth Normal Form (5NF) <small>(Fagin 1979)</small>
</ul>
NF hierarachy: &nbsp; 5NF <i>&rArr;</i> 4NF <i>&rArr;</i> BCNF <i>&rArr;</i> 3NF <i>&rArr;</i> 2NF <i>&rArr;</i> 1NF
<p>
1NF allows most redundancy; &nbsp; 5NF allows least redundancy.
<p>
We say that "a schema is in xNF",  if all of its tables are xNF
<p>
For most practical purposes, BCNF (or 3NF) are acceptable NFs.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [15/39]</div> <DIV class='slideCl1    ' id="s16"  >
<div class='navCl1'><a href="#s15"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s17"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Normal Forms <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
<p><table border='0' cellpadding='6'>
<tr valign=top>
  <td><nobr>1NF</td>
  <td></td><td>
    all attributes have atomic values <br>
    we assume this as part of relational model, <br>
    so <i>every</i> relation schema is in 1NF
  </td>
</tr>
<tr valign=top>
  <td><nobr>2NF</td>
  <td></td><td>
    all non-key attributes fully depend on key <br>
    (i.e. no partial dependencies) <br>
    avoids much redundancy <br>
  </td>
</tr>
<tr valign=top>
  <td><nobr>3NF<br>BCNF</td>
  <td></td><td>
    no attributes dependent on non-key attrs<br>
    (i.e. no transitive dependencies) <br>
    avoids most remaining redundancy <br>
  </td>
</tr>
</table><p>
Boyce-Codd Normal Form (BCNF):
<ul>
<li> eliminates all redundancy due to functional dependencies
<li> but may not preserve original functional dependencies
</ul>
<br>
Third Normal Form (3NF):
<ul>
<li> eliminates most (but not all) redundancy due to <i>fd</i>s
<li> guaranteed to preserve all functional dependencies
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [16/39]</div> <DIV class='slideCl1    ' id="s17"  >
<div class='navCl1'><a href="#s16"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s18"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Normal Forms <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
<p>
<font color='#0000BB'>Normalisation</font> aims to puts a schema into <i>xNF</i>
<ul>
<li> by ensuring that all relations in the schema are in <i>xNF</i>
</ul>
<br>
How normalisation works ...
<ul>
<li> decide which normal form <i>xNF</i> is "acceptable"
<ul>
<li> i.e. how much redundancy are we willing to tolerate?
</ul>
<li> check whether each relation in schema is in <i>xNF</i>
<li> if a relation is not in <i>xNF</i>
<ul>
<li> <font color='#0000BB'>partition</font> into sub-relations where each is "closer to" <i>xNF</i>
</ul>
<li> repeat until all relations in schema are in <i>xNF</i>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [17/39]</div> <DIV class='slideCl1    ' id="s18"  >
<div class='navCl1'><a href="#s17"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s19"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Relation Decomposition</div></td><td align='right'></td></tr></table>
<p>
The standard transformation technique to remove redundancy:
<ul>
<li> <font color='#0000BB'>decompose</font> relation <i>R</i>&nbsp; into relations <i>S</i>&nbsp; and <i>T</i>
</ul>
<p>
We accomplish decomposition by
<ul>
<li> selecting (overlapping) subsets of attributes 
<li> forming new relations based on attribute subsets
</ul>
Properties: &nbsp; <i>R = S &cup; T, &nbsp; S &cap; T &ne; &empty;</i> &nbsp; and &nbsp; <i>r(R) = s(S) &#8904; t(T)</i>
<p>
May require several decompositions to achieve acceptable NF.
<p>
<font color='#0000BB'>Normalization algorithms</font> tell us how to choose <i>S</i> and <i>T</i>.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [18/39]</div> <DIV class='slideCl1    ' id="s19"  >
<div class='navCl1'><a href="#s18"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s20"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Schema (Re)Design</div></td><td align='right'></td></tr></table>
<p>
Consider the following relation for <i>BankLoans</i>:
<div class='center'>
<p><table border='1' cellpadding='2'>
<tr align=center>
  <td><b>branchName</b></td>
  <td><b>branchCity</b></td>
  <td><b>assets</b></td>
  <td><b>custName</b></td>
  <td><b>loanNo</b></td>
  <td><b>amount</b></td>
</tr>
<tr align=center>
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jones</td>
  <td>L-17</td>
  <td>1000</td>
</tr>
<tr align=center>
  <td>Redwood</td>
  <td>Palo Alto</td>
  <td>2100000</td>
  <td>Smith</td>
  <td>L-23</td>
  <td>2000</td>
</tr>
<tr align=center>
  <td>Perryridge</td>
  <td>Horseneck</td>
  <td>1700000</td>
  <td>Hayes</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align=center>
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jackson</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align=center>
  <td>Mianus</td>
  <td>Horseneck</td>
  <td>400000</td>
  <td>Jones</td>
  <td>L-93</td>
  <td>500</td>
</tr>
<tr align=center>
  <td>Round Hill</td>
  <td>Horseneck</td>
  <td>8000000</td>
  <td>Turner</td>
  <td>L-11</td>
  <td>900</td>
</tr>
<tr align=center>
  <td>North Town</td>
  <td>Rye</td>
  <td>3700000</td>
  <td>Hayes</td>
  <td>L-16</td>
  <td>1300</td>
</tr>
</table><p>
</div>
<p>
This schema has all of the update anomalies mentioned earlier.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [19/39]</div> <DIV class='slideCl1    ' id="s20"  >
<div class='navCl1'><a href="#s19"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s21"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Schema (Re)Design <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
To improve the design, decompose the <i>BankLoans</i> relation.
<p>
The following decomposition is not helpful:
<p>
&nbsp;&nbsp;&nbsp; <i>Branch(branchName, branchCity, assets)</i> <br>
&nbsp;&nbsp;&nbsp; <i>CustLoan(custName, loanNo, amount)</i>
<p>
because we lose information <small>(which branch is a loan held at?)</small>
<p>
Another possible decomposition:
<p>
&nbsp;&nbsp;&nbsp; <i>BranchCust(branchName, branchCity, assets, custName)</i> <br>
&nbsp;&nbsp;&nbsp; <i>CustLoan(custName, loanNo, amount)</i>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [20/39]</div> <DIV class='slideCl1    ' id="s21"  >
<div class='navCl1'><a href="#s20"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s22"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Schema (Re)Design <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
The <i>BranchCust</i> relation instance:
<div class='center'>
<p><table border='1' cellpadding='2'>
<tr align=center>
  <td><b>branchName</b></td>
  <td><b>branchCity</b></td>
  <td><b>assets</b></td>
  <td><b>custName</b></td>
</tr>
<tr align=center>
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jones</td>
</tr>
<tr align=center>
  <td>Redwood</td>
  <td>Palo Alto</td>
  <td>2100000</td>
  <td>Smith</td>
</tr>
<tr align=center>
  <td>Perryridge</td>
  <td>Horseneck</td>
  <td>1700000</td>
  <td>Hayes</td>
</tr>
<tr align=center>
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jackson</td>
</tr>
<tr align=center>
  <td>Mianus</td>
  <td>Horseneck</td>
  <td>400000</td>
  <td>Jones</td>
</tr>
<tr align=center>
  <td>Round Hill</td>
  <td>Horseneck</td>
  <td>8000000</td>
  <td>Turner</td>
</tr>
<tr align=center>
  <td>North Town</td>
  <td>Rye</td>
  <td>3700000</td>
  <td>Hayes</td>
</tr>
</table><p>
</div>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [21/39]</div> <DIV class='slideCl1    ' id="s22"  >
<div class='navCl1'><a href="#s21"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s23"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Schema (Re)Design <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
The <i>CustLoan</i> relation instance:
<p>
<div class='center'>
<p><table border='1' cellpadding='2'>
<tr align=center>
  <td><b>custName</b></td>
  <td><b>loanNo</b></td>
  <td><b>amount</b></td>
</tr>
<tr align=center>
  <td>Jones</td>
  <td>L-17</td>
  <td>1000</td>
</tr>
<tr align=center>
  <td>Smith</td>
  <td>L-23</td>
  <td>2000</td>
</tr>
<tr align=center>
  <td>Hayes</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align=center>
  <td>Jackson</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align=center>
  <td>Jones</td>
  <td>L-93</td>
  <td>500</td>
</tr>
<tr align=center>
  <td>Turner</td>
  <td>L-11</td>
  <td>900</td>
</tr>
<tr align=center>
  <td>Hayes</td>
  <td>L-16</td>
  <td>1300</td>
</tr>
</table><p>
</div>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [22/39]</div> <DIV class='slideCl1    ' id="s23"  >
<div class='navCl1'><a href="#s22"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s24"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Schema (Re)Design <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Now consider the result of <i>(BranchCust&nbsp;Join&nbsp;CustLoan)</i>
<p>
<p><table border='1' cellpadding='2'>
<tr align=center>
  <td><b>branchName</b></td>
  <td><b>branchCity</b></td>
  <td><b>assets</b></td>
  <td><b>custName</b></td>
  <td><b>loanNo</b></td>
  <td><b>amount</b></td>
</tr>
<tr align=center>
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jones</td>
  <td>L-17</td>
  <td>1000</td>
</tr>
<tr align=center>
  <td><font color='#0000BB'>Downtown</font></td>
  <td><font color='#0000BB'>Brooklyn</font></td>
  <td><font color='#0000BB'>9000000</font></td>
  <td><font color='#0000BB'>Jones</font></td>
  <td><font color='#0000BB'>L-93</font></td>
  <td><font color='#0000BB'>500</font></td>
</tr>
<tr align=center>
  <td>Redwood</td>
  <td>Palo Alto</td>
  <td>2100000</td>
  <td>Smith</td>
  <td>L-23</td>
  <td>2000</td>
</tr>
<tr align=center>
  <td>Perryridge</td>
  <td>Horseneck</td>
  <td>1700000</td>
  <td>Hayes</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align=center>
  <td><font color='#0000BB'>Perryridge</font></td>
  <td><font color='#0000BB'>Horseneck</font></td>
  <td><font color='#0000BB'>1700000</font></td>
  <td><font color='#0000BB'>Hayes</font></td>
  <td><font color='#0000BB'>L-16</font></td>
  <td><font color='#0000BB'>1300</font></td>
</tr>
<tr align=center>
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jackson</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align=center>
  <td>Mianus</td>
  <td>Horseneck</td>
  <td>400000</td>
  <td>Jones</td>
  <td>L-93</td>
  <td>500</td>
</tr>
<tr align=center>
  <td><font color='#0000BB'>Mianus</font></td>
  <td><font color='#0000BB'>Horseneck</font></td>
  <td><font color='#0000BB'>400000</font></td>
  <td><font color='#0000BB'>Jones</font></td>
  <td><font color='#0000BB'>L-17</font></td>
  <td><font color='#0000BB'>1000</font></td>
</tr>
<tr align=center>
  <td>Round Hill</td>
  <td>Horseneck</td>
  <td>8000000</td>
  <td>Turner</td>
  <td>L-11</td>
  <td>900</td>
</tr>
<tr align=center>
  <td>North Town</td>
  <td>Rye</td>
  <td>3700000</td>
  <td>Hayes</td>
  <td>L-16</td>
  <td>1300</td>
</tr>
<tr align=center>
  <td><font color='#0000BB'>North Town</font></td>
  <td><font color='#0000BB'>Rye</font></td>
  <td><font color='#0000BB'>3700000</font></td>
  <td><font color='#0000BB'>Hayes</font></td>
  <td><font color='#0000BB'>L-15</font></td>
  <td><font color='#0000BB'>1500</font></td>
</tr>
</table><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [23/39]</div> <DIV class='slideCl1    ' id="s24"  >
<div class='navCl1'><a href="#s23"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s25"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Schema (Re)Design <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
This is clearly not a successful decomposition.
<p>
The fact that we ended up with extra tuples was symptomatic of losing
some critical "connection" information during the decomposition.
<p>
Such a decomposition is called a <font color='#0000BB'>lossy decomposition</font>.
<p>
In a good decomposition, we should be able to reconstruct the
original relation exactly:
<p>
<div class='center'>
if <i>R</i> is decomposed into <i>S</i> and <i>T</i>, then <i>Join(S,T) = R</i>
</div>
<p>
Such a decomposition is called <font color='#0000BB'>lossless join decomposition</font>.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [24/39]</div> <DIV class='slideCl1    ' id="s25"  >
<div class='navCl1'><a href="#s24"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s26"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Boyce-Codd Normal Form</div></td><td align='right'></td></tr></table>
<p>
A relation schema <i>R</i> is in BCNF w.r.t a set <i>F</i> of functional dependencies iff:
<p>
for all <i>fd</i>s <i>X &rarr; Y</i> in <i>F<sup>+</sup></i>
<ul>
<li> either <i>X &rarr; Y</i> is trivial (i.e. <i>Y &sub; X</i>)
<li> or <i>X</i> is a superkey  <small>(i.e. non-strict superset of attributes in key)</small>
</ul>
<br>
A DB schema is in BCNF if all of its relation schemas are in BCNF.
<p>
<small>
Observations:
<ul>
<li> any two-attribute relation is in BCNF
<li> any relation with key <i>K</i>, other attributes <i>Y</i>, and <i>K &rarr; Y</i> is in BCNF
</ul>
</small>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [25/39]</div> <DIV class='slideCl1    ' id="s26"  >
<div class='navCl1'><a href="#s25"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s27"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Boyce-Codd Normal Form <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
If we transform a schema into BCNF, we are guaranteed:
<ul>
<li> no update anomalies due to <i>fd</i>-based redundancy
<li> lossless join decomposition
</ul>
However, we are <font color='#0000BB'>not</font> guaranteed:
<ul>
<li> the new schema preserves all <i>fd</i>s from the original schema
</ul>
<p>
This may be a problem if the <i>fd</i>s contain significant semantic
information about the problem domain.
<p>
If we need to preserve dependencies, use 3NF.
<p>
<br>
<small>
A dependency <i>X &rarr; Y</i> is not preserved if, e.g.
<ul>
<li> <i>X = ABC</i> and <i>ABC</i> are all in relation <i>R</i>
<li> after decomposition into <i>S</i> and <i>T</i>, &nbsp;<i>AB</i> is in <i>S</i> &nbsp;and&nbsp; <i>BC</i> is in <i>T</i>
</ul>
</small>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [26/39]</div> <DIV class='slideCl1    ' id="s27"  >
<div class='navCl1'><a href="#s26"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s28"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; BCNF Decomposition</div></td><td align='right'></td></tr></table>
<p>
The following algorithm converts an arbitrary schema to BCNF:
<p><pre style="font-size:90%">
Inputs: schema <i>R</i>, set <i>F</i> of <i>fd</i>s
Output: set <i>Res</i> of BCNF schemas (tables)

<i>Res</i> = {R};
while (any schema <i>S &isin; Res</i> is not in BCNF) {
    choose any <i>fd</i> <i>X &rarr; Y</i> on <i>S</i> that violates BCNF
    <i>Res</i> = <i>(Res-S) &cup; (S-Y) &cup; XY</i>
}
</pre><p>
The last step means: make a table from <i>XY</i>; drop <i>Y</i>&nbsp; from table <i>S</i>
<p>
The "choose any" step means that the algorithm is non-deterministic
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [27/39]</div> <DIV class='slideCl1    ' id="s28"  >
<div class='navCl1'><a href="#s27"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s29"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; BCNF Decomposition <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Example (the <i>BankLoans</i> schema):
<p>
<i>BankLoans(branchName,  branchCity, assets, custName, loanNo, amount)</i>
<p>
Has functional dependencies <i>F</i>
<ul>
<li> <i>branchName &rarr; assets,branchCity</i>
<li> <i>loanNo &rarr; amount,branchName</i>
</ul>
The key for <i>BankLoans</i> is <i>branchName,custName,loanNo</i>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [28/39]</div> <DIV class='slideCl1    ' id="s29"  >
<div class='navCl1'><a href="#s28"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s30"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; BCNF Decomposition <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Applying the BCNF algorithm:
<ul>
<li> check <i>BankLoans</i> relation ... it is not in BCNF <br>
	<small>(<i>branchName &rarr; assets,branchCity</i> violates BCNF
	 criteria; LHS is not a key)</small>
<li> to fix ... decompose <i>BankLoans</i> into <p>
&nbsp;&nbsp;&nbsp; <i>Branch(branchName, branchCity, assets)</i> <br>
&nbsp;&nbsp;&nbsp; <i>LoanInfo(branchName, custName, loanNo, amount)</i>
<li> check <i>Branch</i> relation ... it is in BCNF <br>
	<small>(the only nontrivial <i>fd</i> has LHS=<i>branchName</i>, which is a key)</small>
</ul>
<small>(continued on next slide)</small>
<p>
<small>
Notes:
<ul>
<li> For <i>Branch</i>: key = <i>branchname</i>, &nbsp; FDs are <i>branchName &rarr; assets,branchCity</i>
<li> For <i>LoanInfo</i>: key = <i>loanNo,custName</i>, &nbsp; FDs are <i>loanNo &rarr; amount,branchName</i>
</ul>
</small>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [29/39]</div> <DIV class='slideCl1    ' id="s30"  >
<div class='navCl1'><a href="#s29"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s31"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; BCNF Decomposition <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Applying the BCNF algorithm (cont):
<ul>
<li> check <i>LoanInfo</i> relation ... it is not in BCNF <br>
	<small>(<i>loanNo &rarr; amount,branchName</i> violates BCNF
	criteria; LHS is not a key)</small>
<li> to fix ... decompose <i>LoanInfo</i> into <p>
&nbsp;&nbsp;&nbsp; <i>Loan(branchName, loanNo, amount)</i> <br>
&nbsp;&nbsp;&nbsp; <i>Borrower(custName, loanNo)</i>
<li> check <i>Loan</i> ... it is in BCNF
<li> check <i>Borrower</i> ... it is in BCNF
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [30/39]</div> <DIV class='slideCl1    ' id="s31"  >
<div class='navCl1'><a href="#s30"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s32"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise:  BCNF Decomposition (1)</div></td><td align='right'></td></tr></table>
<p>
Consider the schema <i>R</i> and set of fds <i>F</i>
<p>
<i>R &nbsp;=&nbsp; ABCDEFGH</i>
<p>
<i>F &nbsp;=&nbsp; { ABH &rarr; C, A &rarr; DE, BGH &rarr; F,
F &rarr; ADH, BH &rarr; GE }</i>
<p>
Produce a BCNF decomposition of <i>R</i>.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [31/39]</div> <DIV class='slideCl1    ' id="s32"  >
<div class='navCl1'><a href="#s31"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s33"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise:  BCNF Decomposition (2)</div></td><td align='right'></td></tr></table>
<p>
Recall the following table (based on e.g. a spreadsheet):
<p><pre style="font-size:80%">
<b>P</b>#  | <b>W</b>hen        | <b>A</b>ddress    | <b>N</b>otes         | <b>S</b>#   | Na<b>m</b>e  | <b>C</b>arReg
----+-------------+------------+---------------+------+-------+-------
PG4 | 03/06 15:15 | 55 High St | Bathroom leak | SG44 | Rob   | ABK754
PG1 | 04/06 11:10 | 47 High St | All ok        | SG44 | Rob   | ABK754
PG4 | 03/07 12:30 | 55 High St | All ok        | SG43 | Dave  | ATS123
PG1 | 05/07 15:00 | 47 High St | Broken window | SG44 | Rob   | ABK754
PG1 | 05/07 15:00 | 47 High St | Leaking tap   | SG44 | Rob   | ABK754
PG2 | 13/07 12:00 | 12 High St | All ok        | SG42 | Peter | ATS123
...
</pre><p>
<p>
Recall the functional dependencies identified previously,
<p>
Use these to convert the table to a BCNF schema.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [32/39]</div> <DIV class='slideCl1    ' id="s33"  >
<div class='navCl1'><a href="#s32"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s34"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Third Normal Form</div></td><td align='right'></td></tr></table>
<p>
A relation schema <i>R</i> is in 3NF w.r.t a set <i>F</i> of functional dependencies iff:
<p>
for all <i>fd</i>s <i>X &rarr; Y</i> in <i>F<sup>+</sup></i>
<ul>
<li> either <i>X &rarr; Y</i> is trivial (i.e. <i>Y &sub; X</i>)
<li> or <i>X</i> is a superkey
<li> or <i>Y</i> is a single attribute from a key
</ul>
A DB schema is in 3NF if all relation schemas are in 3NF.
<p>
<small>The extra condition represents a slight weakening of BCNF requirements.</small>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [33/39]</div> <DIV class='slideCl1    ' id="s34"  >
<div class='navCl1'><a href="#s33"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s35"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Third Normal Form <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
If we transform a schema into 3NF, we are guaranteed:
<ul>
<li> lossless join decomposition
<li> the new schema preserves all of the <i>fd</i>s from the original schema
</ul>
However, we are <font color='#0000BB'>not</font> guaranteed:
<ul>
<li> no update anomalies due to <i>fd</i>-based redundancy
</ul>
<p>
Whether to use BCNF or 3NF depends on overall design considerations.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [34/39]</div> <DIV class='slideCl1    ' id="s35"  >
<div class='navCl1'><a href="#s34"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s36"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Third Normal Form <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
The following algorithm converts an arbitrary schema to 3NF:
<p><pre><small>
Inputs: schema <i>R</i>, set <i>F</i> of <i>fd</i>s
Output: set <i>R<sub>i</sub></i> of 3NF schemas

let <i>F<sub>c</sub></i> be a <font color='#0000BB'>minimal cover</font> for <i>F</i>
<i>Res</i> = {}
for each <i>fd</i> <i>X &rarr; Y</i> in <i>F<sub>c</sub></i> {
    if (no schema <i>S &isin; Res</i> contains <i>XY</i>) {
        <i>Res</i> = <i>Res &cup; XY</i>
    }
}
if (no schema <i>S &isin; Res</i> contains a candidate key for <i>R</i>) {
    <i>K</i> = any candidate key for <i>R</i>
    <i>Res</i> = <i>Res &cup; K</i>
}
</small></pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [35/39]</div> <DIV class='slideCl1    ' id="s36"  >
<div class='navCl1'><a href="#s35"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s37"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Third Normal Form <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Critical step is producing minimal cover <i>F<sub>c</sub></i> for <i>F</i>
<p>
A set <i>F</i> of fds is minimal if
<ul>
<li> every fd <i>X &rarr; Y</i> is <i>simple</i> <br>
	<small>(<i>Y</i> is a single attribute)</small>
<li> every fd <i>X &rarr; Y</i> is <i>left-reduced</i> <br>
	<small>(no <i>Z &sub; X</i> such that <i>Z &rarr; A</i> could replace <i>X &rarr; A</i> in <i>F</i> and preserve <i>F<sup>+</sup></i>)</small>
<li> every fd <i>X &rarr; Y</i> is <i>necessary</i> <br>
	<small>(no <i>X &rarr; Y</i> can be removed without changing <i>F<sup>+</sup></i>)</small>
</ul>
Algorithm: right-reduce, left-reduce, eliminate redundant fds
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [36/39]</div> <DIV class='slideCl1    ' id="s37"  >
<div class='navCl1'><a href="#s36"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s38"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise:  3NF Decomposition (1)</div></td><td align='right'></td></tr></table>
<p>
Consider the schema <i>R</i> and set of fds <i>F</i>
<p>
<i>R &nbsp;=&nbsp; ABCDEFGH</i>
<p>
<i>F &nbsp;=&nbsp; F<sub>c</sub> &nbsp;=&nbsp; { BH &rarr; C, A &rarr; D, C &rarr; E,
F &rarr; A, E &rarr; F, BGH &rarr; E }</i>
<p>
Produce a 3NF decomposition of <i>R</i>.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [37/39]</div> <DIV class='slideCl1    ' id="s38"  >
<div class='navCl1'><a href="#s37"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s39"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise:  3NF Decomposition (2)</div></td><td align='right'></td></tr></table>
<p>
Recall the following table (based on e.g. a spreadsheet):
<p><pre><small>
<b>P</b>#  | <b>W</b>hen        | <b>A</b>ddress    | <b>N</b>otes         | <b>S</b>#   | Na<b>m</b>e  | <b>C</b>arReg
----+-------------+------------+---------------+------+-------+-------
PG4 | 03/06 15:15 | 55 High St | Bathroom leak | SG44 | Rob   | ABK754
PG1 | 04/06 11:10 | 47 High St | All ok        | SG44 | Rob   | ABK754
PG4 | 03/07 12:30 | 55 High St | All ok        | SG43 | Dave  | ATS123
PG1 | 05/07 15:00 | 47 High St | Broken window | SG44 | Rob   | ABK754
PG1 | 05/07 15:00 | 47 High St | Leaking tap   | SG44 | Rob   | ABK754
PG2 | 13/07 12:00 | 12 High St | All ok        | SG42 | Peter | ATS123
...
</small></pre><p>
<p>
Recall the functional dependencies identified previously,
<p>
Use these to convert the table to a 3NF schema.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [38/39]</div> <DIV class='slideCl1    ' id="s39"  >
<div class='navCl1'><a href="#s38"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>   </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Database Design Methodology</div></td><td align='right'></td></tr></table>
<p>
To achieve a "good" database design:
<ul>
<li> identify attributes, entities, relationships &nbsp; <i>&rarr;</i> &nbsp; ER design
<li> map ER design to relational schema
<li> identify constraints <small>(including keys and functional dependencies)</small>
<li> apply BCNF/3NF algorithms to produce normalized schema
</ul>
<small>
Note: may subsequently need to "denormalise" if the design yields inadequate performance.
</small>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 8 Monday Lecture &#9826; [39/39]</div><p><hr><p>
<span style='font-size:11px;color: grey;'>Produced: 31 Oct 2022</span>
 <script src='lib/prism.js'></script>   
 <script src='lib/sg.js'></script>   
</body>
</html>
