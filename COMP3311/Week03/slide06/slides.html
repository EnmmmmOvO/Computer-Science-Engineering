<html>
<head>
<title>COMP3311 Week 3 Thursday Lecture</title>
<link href='lib/slides.css' rel='stylesheet' type='text/css'>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" async></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
<link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet'>
<link href='lib/prism.css' rel='stylesheet'>
<script src='lib/sg.js'></script>
</head>
<body>
 <DIV class='slideCl1' id="s0"  >
<div class='navCl1'><a href="#s1"><span class='nextArrowCl'>>></span></a> </div> <div class='heading'>COMP3311 Week 3 Thursday Lecture</div><p><ul class='indexUl'  style='font-size: 0.7em;'><li class="i"> <a href="#s1">Week 03 Thursday</heading></a>
<li class="i"> <a href="#s2">Video Material</a>
<li class="i"> <a href="#s3">Example Database: Beers/Bars/Drinkers</a>
<li class="i"> <a href="#s4">Exercise: Delete/Update Examples</a>
<li class="i"> <a href="#s5">Problem Solving in SQL</a>
<li class="i"> <a href="#s6">Views</a>
<li class="i"> <a href="#s9">SQL Queries</a>
<li class="i"> <a href="#s11">Semantics of SELECT..WHERE</a>
<li class="i"> <a href="#s12">Semantics of JOIN</a>
<li class="i"> <a href="#s13">Exercise: Queries on Simple Beer DB</a>
<li class="i"> <a href="#s14">Finding the biggest/smallest/etc</a>
<li class="i"> <a href="#s17">Exercise: More queries on Simple Beer DB</a>
<li class="i"> <a href="#s18">More Problem Solving in SQL</a>
</ul></DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [0/18]</div> <DIV class='slideCl1    ' id="s1"  >
<div class='navCl1'> <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s2"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Week 03 Thursday</heading></div></td><td align='right'></td></tr></table>
<p>
<h4>In today's lecture ...</h4>
<ul>
<li> SQL Query Language
<li> Stored Procedures
<li> PLpgSQL Procedural language (next week?)
</ul>
<h4>Things to do ...</h4>
<ul>
<li> Quiz 2 due before Friday midnight
<li> Set up your PostgreSQL server <br>
        <span class="smaller">(490/575 students have logged in to vxdb2 and have /localstorage)</span>
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [1/18]</div> <DIV class='slideCl1    ' id="s2"  >
<div class='navCl1'><a href="#s1"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s3"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Video Material</div></td><td align='right'></td></tr></table>
<p>
Slides and Videos
<ul>
<li> (slightly) formal topic-based videos
<li> watch them whenever you need to know their content
</ul>
Lecture Material
<ul>
<li> videos + slides from Tue and Thu lectures
<li> also, exercise files (Data) produced while doing exercises
<li> slides should be avail (just) before the lecture
<li> recording initially on Echo360 &nbsp; <span class="smaller">(takes > 2 hours to be processed)</span>
<li> YouTube version at least 1 hour after Echo360
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [2/18]</div> <DIV class='slideCl1    ' id="s3"  >
<div class='navCl1'><a href="#s2"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s4"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Example Database: Beers/Bars/Drinkers</div></td><td align='right'></td></tr></table>
<p>
Consider the following ER model:
<p>
<div align="center">
<p><div align='center'>
<img alt="[Diagram:Pics/exercises/beer1.png]" src="Pics/exercises/beer1.png">
</div><p>
</div>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [3/18]</div> <DIV class='slideCl1    ' id="s4"  >
<div class='navCl1'><a href="#s3"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s5"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise: Delete/Update Examples</div></td><td align='right'></td></tr></table>
<p>
<br>
Carry out the following actions on the beer database:
<ul>
<li> Increase the prices for beers by 10%
<li> Remove all beers selling for more than 5.00
<li> Remove all drinkers who live in Randwick
<li> Close down the Royal in Randwick
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [4/18]</div> <DIV class='slideCl1    ' id="s5"  >
<div class='navCl1'><a href="#s4"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s6"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Problem Solving in SQL</div></td><td align='right'></td></tr></table>
<p>
Developing SQL queries ...
<ul>
<li> relate required data to <font color='#0000BB'>attributes</font> in schema
<li> identify which <font color='#0000BB'>tables</font> contain these attributes
<li> combine data from relevant tables (<font color='#0000BB'><large><code>FROM</code></large></font>, <font color='#0000BB'><large><code>JOIN</code></large></font>)
<li> specify conditions to select relevant data (<font color='#0000BB'><large><code>WHERE</code></large></font>)
<li> [optional] define grouping attributes (<font color='#0000BB'><large><code>GROUP BY</code></large></font>)
<li> develop expressions to compute output values (<font color='#0000BB'><large><code>SELECT</code></large></font>)
</ul>
Learn some query patterns and know when to apply them
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [5/18]</div> <DIV class='slideCl1    ' id="s6"  >
<div class='navCl1'><a href="#s5"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s7"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Views</div></td><td align='right'></td></tr></table>
<p>
Views are like "virtual tables"
<p><pre style="font-size:90%">
<font color="#008800">create [or replace] view</font> <i>ViewName</i> <font color="#008800">(</font> <i>AttributeNames</i> <font color="#008800">)</font>
<font color="#008800">as</font>
<font color="#008800">select</font> <i>ResultValues (one per attribute)</i> <font color="#008800">from</font> ... <font color="#008800">;</font>
</pre><p>
Things to note:
<ul>
<li> <large><code>AttributeNames</code></large> are <i>outputs</i> 
<li> inherit their type from corresponding <large><code>select</code></large> expression
<li> each view has an associated tuple type (like a table does)
</ul>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [6/18]</div> <DIV class='slideCl1    ' id="s7"  >
<div class='navCl1'><a href="#s6"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s8"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Views <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Views are very useful in simplifying complex queries
<p>
Views look like tables
<ul>
<li> you <i>can</i>&nbsp; refer to them in queries
<li> you <i>cannot</i>&nbsp; make changes via a view
	&nbsp; <span class="smaller">(i.e. no insert/delete/update)</small>
</ul>
If using &nbsp;<large><code>create or replace view</code></large>&nbsp; you cannot
<ul>
<li> change the number of attributes &nbsp; <span class="smaller">(by changing view's heading)</span>
<li> change the types of attributes &nbsp; <span class="smaller">(by changing view's query)</span>
</ul>
Need to &nbsp;<large><code>drop view</code></large>&nbsp;, then &nbsp;<large><code>create view</code></large>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [7/18]</div> <DIV class='slideCl1    ' id="s8"  >
<div class='navCl1'><a href="#s7"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s9"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Views <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Two ways of defining a view
<p><pre>
create or replace view V
as
select x as a1, y as a2, z as a3
from   R
where  ... ;

<span class='comment'>-- alternatively</span>

create or replace view V(a1, a2, a3)
as
select x, y, z
from   R
where  ...;
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [8/18]</div> <DIV class='slideCl1    ' id="s9"  >
<div class='navCl1'><a href="#s8"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s10"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; SQL Queries</div></td><td align='right'></td></tr></table>
<p>
Functionality provided by SQL ...
<p>
<font color='#0000BB'>Filtering</font>: extract attributes from tuples, extract tuples from tables
<p><pre>
SELECT b,c FROM R(a,b,c,d) WHERE a > 5
</pre><p>
<font color='#0000BB'>Combining</font>: merging related tuples from different tables
<p><pre>
... FROM R(x,y,z) JOIN S(a,b,c) ON R.y = S.a
</pre><p>
<font color='#0000BB'>Summarising</font>: aggregating values in a single column
<p><pre>
SELECT avg(mark) FROM ...
</pre><p>
<font color='#0000BB'>Set operations</font>: union, intersection, difference
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [9/18]</div> <DIV class='slideCl1    ' id="s10"  >
<div class='navCl1'><a href="#s9"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s11"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; SQL Queries <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
More functionality provided by SQL ...
<p>
<font color='#0000BB'>Grouping</font>: forming subsets of tuples sharing some property
<p><pre>
... GROUP BY R.a
</pre><p>
<small>
(forms groups of tuples from <large><code>R</code></large> sharing the same value of <large><code>a</code></large>)
</small>
<p>
<font color='#0000BB'>Group Filtering</font>: selecting only groups satisfying a condition
<p><pre>
... GROUP BY R.a HAVING max(R.a) &lt; 75
</pre><p>
<font color='#0000BB'>Renaming</font>: assign a name to a component of a query
<p><pre>
SELECT a as <font color="#0000EE">name</font>
FROM Employee(a,b,c) <font color="#0000EE">e</font> WHERE e.b &gt; 50000
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [10/18]</div> <DIV class='slideCl1    ' id="s11"  >
<div class='navCl1'><a href="#s10"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s12"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Semantics of SELECT..WHERE</div></td><td align='right'></td></tr></table>
<p>
The query
<p><pre>
SELECT * FROM R WHERE Condition
</pre><p>
can be treated as
<p><pre>
Results = {}
foreach tuple T in R {
   if T satisfies Condition
      add T to Results
}
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [11/18]</div> <DIV class='slideCl1    ' id="s12"  >
<div class='navCl1'><a href="#s11"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s13"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Semantics of JOIN</div></td><td align='right'></td></tr></table>
<p>
The query
<p><pre>
SELECT * FROM R JOIN S ON R.x = S.y WHERE Condition
</pre><p>
can be treated as
<p><pre>
Results = {}
foreach tuple T<sub>R</sub> in R {
   foreach tuple T<sub>S</sub> in S {
      if T<sub>R</sub>.x == T<sub>S</sub>.y {
         T<sub>joined</sub> = T<sub>R</sub>+T<sub>S</sub>  <span class='comment'># combined</span>
         if T<sub>joined</sub> satisfies Condition
            add T<sub>joined</sub> to Results
      }
   }
}
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [12/18]</div> <DIV class='slideCl1    ' id="s13"  >
<div class='navCl1'><a href="#s12"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s14"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise: Queries on Simple Beer DB</div></td><td align='right'></td></tr></table>
<p>
Answer these queries on the Beer database:
<p>
<ol start="1">
<li> What beers are made by Toohey's?
<li> Show beers with headings "Beer", "Brewer".
<li> How many different beers are there?
<li> How many different brewers are there?
<li> Find pairs of beers by the same manufacturer.
<li> (a) Which beers does John like? <br>
       (b) Find the brewers whose beers John likes.
<li> (a) How many beers does each brewer make? <br>
       (b) Which brewer makes the most beers? <br>
       (c) Which beers are the only one made by their brewer?
</ol>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [13/18]</div> <DIV class='slideCl1    ' id="s14"  >
<div class='navCl1'><a href="#s13"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s15"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Finding the biggest/smallest/etc</div></td><td align='right'></td></tr></table>
<p>
Example: what is the most expensive beer?
<ul>
<li> what is the highest price for a beer
<li> which beers are sold for this price
</ul>
As SQL:
<p><pre>
create view maxPrice as select max(price) from Sells;

create view highestPriceBeer as
select s.beer
from   Sells s 
where  s.price = (select * from maxPrice);
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [14/18]</div> <DIV class='slideCl1    ' id="s15"  >
<div class='navCl1'><a href="#s14"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s16"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Finding the biggest/smallest/etc <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
Don't need the view; can calculate "inline"
<p>
<p><pre>
create view highestPriceBeer as
select s.beer
from   Sells s
where  s.price = (select max(price) from Sells);
</pre><p>
<p>
But you always need a query to extract the single value
<p><br>
An example of a common pattern:
<ul>
<li> what is the <i>X</i>&nbsp; of the <i>Y</i>&nbsp; with the maximum/minimum <i>Z</i>&nbsp;?
</ul>
E.g. &nbsp; X = name, &nbsp; Y = beer, &nbsp; Z = price
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [15/18]</div> <DIV class='slideCl1    ' id="s16"  >
<div class='navCl1'><a href="#s15"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s17"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Finding the biggest/smallest/etc <span style="font-size:67%">(cont)</span></div></td><td align='right'></td></tr></table>
<p>
<br>
Note: there may be more than one equally biggest/smallest
<p>
The following is <font color="#CC0000">not</font> a general solution
<p><pre>
create view highestPriceBeer as
select s.beer
from   Sells s
order  by s.price desc
limit  1
</pre><p>
Avoid <large><code>limit</code></large> unless doing e.g. pagination.
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [16/18]</div> <DIV class='slideCl1    ' id="s17"  >
<div class='navCl1'><a href="#s16"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>  <a href="#s18"><span class='nextArrowCl'> >> </span></a> </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; Exercise: More queries on Simple Beer DB</div></td><td align='right'></td></tr></table>
<p>
<br>
<ol start="8">
<li> List of beers by each brewer
<li> Find the beers sold at bars where John drinks.
<li> Bars where either Gernot or John drink.
<li> Bars where both Gernot and John drink.
<li> Bars where John drinks but Gernot doesn't.
<li> Find bars that serve New at the same price <br>
    as the Coogee Bay Hotel charges for VB.
<li> Find the average price of common beers <br>
    <small>(i.e. served in more than two hotels).</small>
<li> Which bar sells 'New' cheapest?
</ol>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [17/18]</div> <DIV class='slideCl1    ' id="s18"  >
<div class='navCl1'><a href="#s17"><span class='prevArrowCl'> << </span></a>  <a href="#s0"><span class='upArrowCl'>&and;</span></a>   </div> <table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><div class='heading'>&#10070; More Problem Solving in SQL</div></td><td align='right'></td></tr></table>
<p>
Example: what is cheapest beer at each bar?
<p><pre>
for each Bar {
   find cheapest price at the bar
   fine name of beer with <font color='#0000BB'>this price</font>
}
</pre><p>
Needs <font color='#0000BB'>correlated subquery</font>
<p><pre>
select s.bar, s.beer, s.price:numeric(4,2)
from   Sells <font color="#CC0000">s</font>
where  s.price = (select min(s1.price)
                  from   Sells s1
                  where  s1.bar = <font color="#CC0000">s</font>.bar);
</pre><p>
</DIV>
<div class='slideNumCl2'>COMP3311 22T3 &#9826; Week 3 Thursday Lecture &#9826; [18/18]</div><p><hr><p>
<span style='font-size:11px;color: grey;'>Produced: 6 Mar 2023</span>
 <script src='lib/prism.js'></script>   
 <script src='lib/sg.js'></script>   
</body>
</html>
